{"version":3,"sources":["../../js/map.js"],"names":["$selectExclude","$selectPokemonNotify","$selectRarityNotify","$textPerfectionNotify","$selectStyle","$selectIconResolution","$selectIconSize","$selectLuredPokestopsOnly","$selectSearchIconMarker","$selectLocationIconMarker","language","document","documentElement","lang","idToPokemon","i8lnDictionary","languageLookups","languageLookupThreshold","searchMarkerStyles","excludedPokemon","notifiedPokemon","notifiedRarity","notifiedMinPerfection","moves","map","rawDataIsLoading","locationMarker","rangeMarkers","searchMarker","storeZoom","scanPath","selectedStyle","gymTypes","audio","Audio","pokemonSprites","normal","columns","iconWidth","iconHeight","spriteWidth","spriteHeight","filename","name","highres","shuffle","StoreTypes","Boolean","parse","str","toLowerCase","stringify","b","JSON","json","String","Number","parseInt","number","toString","StoreOptions","default","type","isTouchDevice","Store","getOption","key","option","Error","get","optionType","rawValue","localStorage","undefined","value","set","reset","removeItem","excludePokemon","id","val","concat","trigger","notifyAboutPokemon","removePokemonMarker","encounterId","mapData","pokemons","marker","rangeCircle","setMap","hidden","initMap","google","maps","Map","getElementById","center","lat","centerLat","lng","centerLng","zoom","fullscreenControl","streetViewControl","mapTypeControl","clickableIcons","mapTypeControlOptions","style","MapTypeControlStyle","DROPDOWN_MENU","position","ControlPosition","RIGHT_TOP","mapTypeIds","MapTypeId","ROADMAP","SATELLITE","HYBRID","styleNoLabels","StyledMapType","noLabelsStyle","mapTypes","styleDark","darkStyle","styleLight2","light2Style","stylePgo","pGoStyle","styleDarkNl","darkStyleNoLabels","styleLight2Nl","light2StyleNoLabels","stylePgoNl","pGoStyleNoLabels","addListener","s","mapTypeId","setMapTypeId","updateMap","getZoom","redrawPokemon","lurePokemons","createSearchMarker","createLocationMarker","createMyLocationButton","initSidebar","updateLocationMarker","setIcon","icon","Marker","animation","Animation","DROP","draggable","optimized","zIndex","MAX_ZINDEX","infoWindow","InfoWindow","content","disableAutoPan","addListeners","event","newLocation","getPosition","updateSearchMarker","oldLocation","changeSearchLocation","done","fail","setPosition","searchControlURI","searchControl","action","$","post","encodeURIComponent","updateSearchStatus","getJSON","then","data","prop","status","toggle","searchBox","places","SearchBox","css","setInterval","getPlaces","length","loc","geometry","location","changeLocation","icons","each","append","attr","text","pad","slice","getTypeSpan","openMapDirections","myLocation","url","window","open","pokemonLabel","rarity","types","disappearTime","latitude","longitude","ivAttack","ivDefense","ivStamina","move1","move2","disappearDate","Date","rarityDisplay","typesDisplay","index","ivstring","perfect","toFixed","moveString","contentstring","getHours","getMinutes","getSeconds","gymLabel","teamName","teamId","gymPoints","lastScanned","members","memberStr","i","pokemon_name","trainer_name","trainer_level","pokemon_id","pokemon_cp","lastScannedStr","lastScannedDate","getFullYear","getMonth","getDate","nameStr","gymColor","gymPrestige","gymLevel","pokestopLabel","expireTime","expireDate","formatSpawnTime","seconds","Math","floor","substr","spawnpointLabel","item","time","special","addRangeCircle","targetmap","circleCenter","LatLng","gymColors","teamColor","range","circleColor","rangeCircleOpts","radius","strokeWeight","strokeColor","strokeOpacity","fillColor","fillOpacity","Circle","isRangeActive","customizePokemonMarker","skipNotification","iconSize","pokemonIndex","sprite","getGoogleSprite","animationDisabled","setAnimation","indexOf","play","sendNotification","BOUNCE","perfection","setupGymMarker","updateGymMarker","setContent","setupPokestopMarker","imagename","getColorByDate","diff","now","hue","join","setupScannedMarker","clickable","getColorBySpawnTime","round","changeSpawnIcon","color","urlColor","zoomScale","minimumSize","newSize","newIcon","scaledSize","Size","anchor","Point","spawnPointIndex","newIndex","scale","setupSpawnpointMarker","clearSelection","selection","empty","getSelection","removeAllRanges","updateLabelDiffTime","persist","close","clearStaleMarkers","getTime","scanned","showInBoundsMarkers","markers","show","getBounds","intersects","contains","team_id","getMap","oldAnimation","getAnimation","loadRawData","loadPokemon","loadGyms","loadPokestops","loadScanned","loadSpawnpoints","bounds","swPoint","getSouthWest","nePoint","getNorthEast","swLat","swLng","neLat","neLng","ajax","dataType","cache","beforeSend","complete","processPokemons","oldMarker","setupPokemonMarker","processPokestops","pokestops","item2","processGyms","gyms","processScanned","scanId","setOptions","processSpawnpoints","spawnpoints","setZIndex","result","hasClass","countMarkers","drawScanPath","points","scanPathPoints","idx","point","push","Polyline","path","geodesic","pokemonList","newMarker","element","disappearsAt","getAttribute","difference","abs","hours","minutes","timestring","getPointDistance","pointA","pointB","spherical","computeDistanceBetween","title","Notification","permission","requestPermission","notification","body","sound","onclick","focus","centerMap","locationContainer","createElement","locationButton","backgroundColor","border","outline","width","height","borderRadius","boxShadow","cursor","marginRight","padding","appendChild","locationIcon","margin","backgroundImage","backgroundSize","backgroundPosition","backgroundRepeat","addEventListener","centerMapOnLocation","controls","RIGHT_BOTTOM","currentLocation","imgX","animationInterval","navigator","geolocation","getCurrentPosition","latlng","coords","setCenter","clearInterval","setZoom","i8ln","word","isEmptyObject","async","success","error","jqXHR","console","log","styleList","select2","placeholder","minimumResultsForSearch","Infinity","on","e","searchMarkerStyleList","selectSearchIconMarker","formatState","state","$state","numberOfPokemon","pokeList","_types","pokemonType","templateResult","isNaN","panTo","buildSwitchChangeListener","storageKey","checked","d","dType","change","options","wrapper","hide","bind","setDraggable","accordion","active","collapsible","heightStyle"],"mappings":"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","file":"map.built.js","sourcesContent":["//\r\n// Global map.js variables\r\n//\r\n\r\nvar $selectExclude\r\nvar $selectPokemonNotify\r\nvar $selectRarityNotify\r\nvar $textPerfectionNotify\r\nvar $selectStyle\r\nvar $selectIconResolution\r\nvar $selectIconSize\r\nvar $selectLuredPokestopsOnly\r\nvar $selectSearchIconMarker\r\nvar $selectLocationIconMarker\r\n\r\nvar language = document.documentElement.lang === '' ? 'en' : document.documentElement.lang\r\nvar idToPokemon = {}\r\nvar i8lnDictionary = {}\r\nvar languageLookups = 0\r\nvar languageLookupThreshold = 3\r\n\r\nvar searchMarkerStyles\r\n\r\nvar excludedPokemon = []\r\nvar notifiedPokemon = []\r\nvar notifiedRarity = []\r\nvar notifiedMinPerfection = null\r\n\r\nvar moves\r\nvar map\r\nvar rawDataIsLoading = false\r\nvar locationMarker\r\nvar rangeMarkers = ['pokemon', 'pokestop', 'gym']\r\nvar searchMarker\r\nvar storeZoom = true\r\nvar scanPath\r\n\r\n\r\nvar selectedStyle = 'light'\r\n\r\n\r\nvar gymTypes = ['Uncontested', 'Mystic', 'Valor', 'Instinct']\r\nvar audio = new Audio('static/sounds/ding.mp3')\r\n\r\nvar pokemonSprites = {\r\n  normal: {\r\n    columns: 12,\r\n    iconWidth: 30,\r\n    iconHeight: 30,\r\n    spriteWidth: 360,\r\n    spriteHeight: 390,\r\n    filename: 'static/icons-sprite.png',\r\n    name: 'Normal'\r\n  },\r\n  highres: {\r\n    columns: 7,\r\n    iconWidth: 65,\r\n    iconHeight: 65,\r\n    spriteWidth: 455,\r\n    spriteHeight: 1430,\r\n    filename: 'static/icons-large-sprite.png',\r\n    name: 'High-Res'\r\n  },\r\n  shuffle: {\r\n    columns: 7,\r\n    iconWidth: 65,\r\n    iconHeight: 65,\r\n    spriteWidth: 455,\r\n    spriteHeight: 1430,\r\n    filename: 'static/icons-shuffle-sprite.png',\r\n    name: 'Shuffle'\r\n  }\r\n}\r\n\r\n//\r\n// LocalStorage helpers\r\n//\r\n\r\nvar StoreTypes = {\r\n  Boolean: {\r\n    parse: function (str) {\r\n      switch (str.toLowerCase()) {\r\n        case '1':\r\n        case 'true':\r\n        case 'yes':\r\n          return true\r\n        default:\r\n          return false\r\n      }\r\n    },\r\n    stringify: function (b) {\r\n      return b ? 'true' : 'false'\r\n    }\r\n  },\r\n  JSON: {\r\n    parse: function (str) {\r\n      return JSON.parse(str)\r\n    },\r\n    stringify: function (json) {\r\n      return JSON.stringify(json)\r\n    }\r\n  },\r\n  String: {\r\n    parse: function (str) {\r\n      return str\r\n    },\r\n    stringify: function (str) {\r\n      return str\r\n    }\r\n  },\r\n  Number: {\r\n    parse: function (str) {\r\n      return parseInt(str, 10)\r\n    },\r\n    stringify: function (number) {\r\n      return number.toString()\r\n    }\r\n  }\r\n}\r\n\r\nvar StoreOptions = {\r\n  'map_style': {\r\n    default: 'roadmap',\r\n    type: StoreTypes.String\r\n  },\r\n  'remember_select_exclude': {\r\n    default: [],\r\n    type: StoreTypes.JSON\r\n  },\r\n  'remember_select_notify': {\r\n    default: [],\r\n    type: StoreTypes.JSON\r\n  },\r\n  'remember_select_rarity_notify': {\r\n    default: [],\r\n    type: StoreTypes.JSON\r\n  },\r\n  'remember_text_perfection_notify': {\r\n    default: '',\r\n    type: StoreTypes.Number\r\n  },\r\n  'showGyms': {\r\n    default: false,\r\n    type: StoreTypes.Boolean\r\n  },\r\n  'showPokemon': {\r\n    default: true,\r\n    type: StoreTypes.Boolean\r\n  },\r\n  'showPokestops': {\r\n    default: true,\r\n    type: StoreTypes.Boolean\r\n  },\r\n  'showLuredPokestopsOnly': {\r\n    default: 0,\r\n    type: StoreTypes.Number\r\n  },\r\n  'showScanned': {\r\n    default: false,\r\n    type: StoreTypes.Boolean\r\n  },\r\n  'showSpawnpoints': {\r\n    default: false,\r\n    type: StoreTypes.Boolean\r\n  },\r\n  'showRanges': {\r\n    default: false,\r\n    type: StoreTypes.Boolean\r\n  },\r\n  'playSound': {\r\n    default: false,\r\n    type: StoreTypes.Boolean\r\n  },\r\n  'geoLocate': {\r\n    default: false,\r\n    type: StoreTypes.Boolean\r\n  },\r\n  'lockMarker': {\r\n    default: isTouchDevice(), // default to true if touch device\r\n    type: StoreTypes.Boolean\r\n  },\r\n  'startAtUserLocation': {\r\n    default: false,\r\n    type: StoreTypes.Boolean\r\n  },\r\n  'followMyLocation': {\r\n    default: false,\r\n    type: StoreTypes.Boolean\r\n  },\r\n  'followMyLocationPosition': {\r\n    default: [],\r\n    type: StoreTypes.JSON\r\n  },\r\n  'pokemonIcons': {\r\n    default: 'highres',\r\n    type: StoreTypes.String\r\n  },\r\n  'iconSizeModifier': {\r\n    default: 0,\r\n    type: StoreTypes.Number\r\n  },\r\n  'searchMarkerStyle': {\r\n    default: 'google',\r\n    type: StoreTypes.String\r\n  },\r\n  'locationMarkerStyle': {\r\n    default: 'none',\r\n    type: StoreTypes.String\r\n  },\r\n  'zoomLevel': {\r\n    default: 16,\r\n    type: StoreTypes.Number\r\n  }\r\n}\r\n\r\nvar Store = {\r\n  getOption: function (key) {\r\n    var option = StoreOptions[key]\r\n    if (!option) {\r\n      throw new Error('Store key was not defined ' + key)\r\n    }\r\n    return option\r\n  },\r\n  get: function (key) {\r\n    var option = this.getOption(key)\r\n    var optionType = option.type\r\n    var rawValue = localStorage[key]\r\n    if (rawValue === null || rawValue === undefined) {\r\n      return option.default\r\n    }\r\n    var value = optionType.parse(rawValue)\r\n    return value\r\n  },\r\n  set: function (key, value) {\r\n    var option = this.getOption(key)\r\n    var optionType = option.type || StoreTypes.String\r\n    var rawValue = optionType.stringify(value)\r\n    localStorage[key] = rawValue\r\n  },\r\n  reset: function (key) {\r\n    localStorage.removeItem(key)\r\n  }\r\n}\r\n//\r\n// Functions\r\n//\r\n\r\nfunction excludePokemon (id) { // eslint-disable-line no-unused-vars\r\n  $selectExclude.val(\r\n    $selectExclude.val().concat(id)\r\n  ).trigger('change')\r\n}\r\n\r\nfunction notifyAboutPokemon (id) { // eslint-disable-line no-unused-vars\r\n  $selectPokemonNotify.val(\r\n    $selectPokemonNotify.val().concat(id)\r\n  ).trigger('change')\r\n}\r\n\r\nfunction removePokemonMarker (encounterId) { // eslint-disable-line no-unused-vars\r\n  if (mapData.pokemons[encounterId].marker.rangeCircle) {\r\n    mapData.pokemons[encounterId].marker.rangeCircle.setMap(null)\r\n    delete mapData.pokemons[encounterId].marker.rangeCircle\r\n  }\r\n  mapData.pokemons[encounterId].marker.setMap(null)\r\n  mapData.pokemons[encounterId].hidden = true\r\n}\r\n\r\nfunction initMap () { // eslint-disable-line no-unused-vars\r\n  map = new google.maps.Map(document.getElementById('map'), {\r\n    center: {\r\n      lat: centerLat,\r\n      lng: centerLng\r\n    },\r\n    zoom: Store.get('zoomLevel'),\r\n    fullscreenControl: true,\r\n    streetViewControl: false,\r\n    mapTypeControl: false,\r\n    clickableIcons: false,\r\n    mapTypeControlOptions: {\r\n      style: google.maps.MapTypeControlStyle.DROPDOWN_MENU,\r\n      position: google.maps.ControlPosition.RIGHT_TOP,\r\n      mapTypeIds: [\r\n        google.maps.MapTypeId.ROADMAP,\r\n        google.maps.MapTypeId.SATELLITE,\r\n        google.maps.MapTypeId.HYBRID,\r\n        'nolabels_style',\r\n        'dark_style',\r\n        'style_light2',\r\n        'style_pgo',\r\n        'dark_style_nl',\r\n        'style_light2_nl',\r\n        'style_pgo_nl'\r\n      ]\r\n    }\r\n  })\r\n\r\n  var styleNoLabels = new google.maps.StyledMapType(noLabelsStyle, {\r\n    name: 'No Labels'\r\n  })\r\n  map.mapTypes.set('nolabels_style', styleNoLabels)\r\n\r\n  var styleDark = new google.maps.StyledMapType(darkStyle, {\r\n    name: 'Dark'\r\n  })\r\n  map.mapTypes.set('dark_style', styleDark)\r\n\r\n  var styleLight2 = new google.maps.StyledMapType(light2Style, {\r\n    name: 'Light2'\r\n  })\r\n  map.mapTypes.set('style_light2', styleLight2)\r\n\r\n  var stylePgo = new google.maps.StyledMapType(pGoStyle, {\r\n    name: 'PokemonGo'\r\n  })\r\n  map.mapTypes.set('style_pgo', stylePgo)\r\n\r\n  var styleDarkNl = new google.maps.StyledMapType(darkStyleNoLabels, {\r\n    name: 'Dark (No Labels)'\r\n  })\r\n  map.mapTypes.set('dark_style_nl', styleDarkNl)\r\n\r\n  var styleLight2Nl = new google.maps.StyledMapType(light2StyleNoLabels, {\r\n    name: 'Light2 (No Labels)'\r\n  })\r\n  map.mapTypes.set('style_light2_nl', styleLight2Nl)\r\n\r\n  var stylePgoNl = new google.maps.StyledMapType(pGoStyleNoLabels, {\r\n    name: 'PokemonGo (No Labels)'\r\n  })\r\n  map.mapTypes.set('style_pgo_nl', stylePgoNl)\r\n\r\n  map.addListener('maptypeid_changed', function (s) {\r\n    Store.set('map_style', this.mapTypeId)\r\n  })\r\n\r\n  map.setMapTypeId(Store.get('map_style'))\r\n  map.addListener('idle', updateMap)\r\n\r\n  map.addListener('zoom_changed', function () {\r\n    if (storeZoom === true) {\r\n      Store.set('zoomLevel', this.getZoom())\r\n    } else {\r\n      storeZoom = true\r\n    }\r\n\r\n    redrawPokemon(mapData.pokemons)\r\n    redrawPokemon(mapData.lurePokemons)\r\n  })\r\n\r\n  searchMarker = createSearchMarker()\r\n  locationMarker = createLocationMarker()\r\n  createMyLocationButton()\r\n  initSidebar()\r\n}\r\n\r\nfunction updateLocationMarker (style) {\r\n  if (style in searchMarkerStyles) {\r\n    locationMarker.setIcon(searchMarkerStyles[style].icon)\r\n    Store.set('locationMarkerStyle', style)\r\n  }\r\n  return locationMarker\r\n}\r\n\r\nfunction createLocationMarker () {\r\n  var position = Store.get('followMyLocationPosition')\r\n  var lat = ('lat' in position) ? position.lat : centerLat\r\n  var lng = ('lng' in position) ? position.lng : centerLng\r\n\r\n  var locationMarker = new google.maps.Marker({\r\n    map: map,\r\n    animation: google.maps.Animation.DROP,\r\n    position: {\r\n      lat: lat,\r\n      lng: lng\r\n    },\r\n    draggable: true,\r\n    icon: null,\r\n    optimized: false,\r\n    zIndex: google.maps.Marker.MAX_ZINDEX + 2\r\n  })\r\n\r\n  locationMarker.infoWindow = new google.maps.InfoWindow({\r\n    content: '<div><b>My Location</b></div>',\r\n    disableAutoPan: true\r\n  })\r\n\r\n  addListeners(locationMarker)\r\n\r\n  google.maps.event.addListener(locationMarker, 'dragend', function () {\r\n    var newLocation = locationMarker.getPosition()\r\n    Store.set('followMyLocationPosition', { lat: newLocation.lat(), lng: newLocation.lng() })\r\n  })\r\n\r\n  return locationMarker\r\n}\r\n\r\nfunction updateSearchMarker (style) {\r\n  if (style in searchMarkerStyles) {\r\n    searchMarker.setIcon(searchMarkerStyles[style].icon)\r\n    Store.set('searchMarkerStyle', style)\r\n  }\r\n\r\n  return searchMarker\r\n}\r\n\r\nfunction createSearchMarker () {\r\n  var searchMarker = new google.maps.Marker({ // need to keep reference.\r\n    position: {\r\n      lat: centerLat,\r\n      lng: centerLng\r\n    },\r\n    map: map,\r\n    animation: google.maps.Animation.DROP,\r\n    draggable: !Store.get('lockMarker'),\r\n    icon: null,\r\n    optimized: false,\r\n    zIndex: google.maps.Marker.MAX_ZINDEX + 1\r\n  })\r\n\r\n  searchMarker.infoWindow = new google.maps.InfoWindow({\r\n    content: '<div><b>Search Location</b></div>',\r\n    disableAutoPan: true\r\n  })\r\n\r\n  addListeners(searchMarker)\r\n\r\n  var oldLocation = null\r\n  google.maps.event.addListener(searchMarker, 'dragstart', function () {\r\n    oldLocation = searchMarker.getPosition()\r\n  })\r\n\r\n  google.maps.event.addListener(searchMarker, 'dragend', function () {\r\n    var newLocation = searchMarker.getPosition()\r\n    changeSearchLocation(newLocation.lat(), newLocation.lng())\r\n      .done(function () {\r\n        oldLocation = null\r\n      })\r\n      .fail(function () {\r\n        if (oldLocation) {\r\n          searchMarker.setPosition(oldLocation)\r\n        }\r\n      })\r\n  })\r\n\r\n  return searchMarker\r\n}\r\n\r\nvar searchControlURI = 'search_control'\r\nfunction searchControl (action) {\r\n  $.post(searchControlURI + '?action=' + encodeURIComponent(action))\r\n}\r\nfunction updateSearchStatus () {\r\n  $.getJSON(searchControlURI).then(function (data) {\r\n    $('#search-switch').prop('checked', data.status)\r\n  })\r\n}\r\n\r\nfunction initSidebar () {\r\n  $('#gyms-switch').prop('checked', Store.get('showGyms'))\r\n  $('#pokemon-switch').prop('checked', Store.get('showPokemon'))\r\n  $('#pokestops-switch').prop('checked', Store.get('showPokestops'))\r\n  $('#lured-pokestops-only-switch').val(Store.get('showLuredPokestopsOnly'))\r\n  $('#lured-pokestops-only-wrapper').toggle(Store.get('showPokestops'))\r\n  $('#geoloc-switch').prop('checked', Store.get('geoLocate'))\r\n  $('#lock-marker-switch').prop('checked', Store.get('lockMarker'))\r\n  $('#start-at-user-location-switch').prop('checked', Store.get('startAtUserLocation'))\r\n  $('#follow-my-location-switch').prop('checked', Store.get('followMyLocation'))\r\n  $('#scanned-switch').prop('checked', Store.get('showScanned'))\r\n  $('#spawnpoints-switch').prop('checked', Store.get('showSpawnpoints'))\r\n  $('#ranges-switch').prop('checked', Store.get('showRanges'))\r\n  $('#sound-switch').prop('checked', Store.get('playSound'))\r\n  var searchBox = new google.maps.places.SearchBox(document.getElementById('next-location'))\r\n  $('#next-location').css('background-color', $('#geoloc-switch').prop('checked') ? '#e0e0e0' : '#ffffff')\r\n\r\n  updateSearchStatus()\r\n  setInterval(updateSearchStatus, 5000)\r\n\r\n  searchBox.addListener('places_changed', function () {\r\n    var places = searchBox.getPlaces()\r\n\r\n    if (places.length === 0) {\r\n      return\r\n    }\r\n\r\n    var loc = places[0].geometry.location\r\n    changeLocation(loc.lat(), loc.lng())\r\n  })\r\n\r\n  var icons = $('#pokemon-icons')\r\n  $.each(pokemonSprites, function (key, value) {\r\n    icons.append($('<option></option>').attr('value', key).text(value.name))\r\n  })\r\n  icons.val((pokemonSprites[Store.get('pokemonIcons')]) ? Store.get('pokemonIcons') : 'highres')\r\n  $('#pokemon-icon-size').val(Store.get('iconSizeModifier'))\r\n}\r\n\r\nfunction pad (number) {\r\n  return number <= 99 ? ('0' + number).slice(-2) : number\r\n}\r\n\r\nfunction getTypeSpan (type) {\r\n  return `<span style='padding: 2px 5px; text-transform: uppercase; color: white; margin-right: 2px; border-radius: 4px; font-size: 0.8em; vertical-align: text-bottom; background-color: ${type['color']}'>${type['type']}</span>`\r\n}\r\n\r\nfunction openMapDirections (lat, lng) { // eslint-disable-line no-unused-vars\r\n  var myLocation = locationMarker.getPosition()\r\n  var url = 'https://www.google.com/maps/dir/' + myLocation.lat() + ',' + myLocation.lng() + '/' + lat + ',' + lng\r\n  window.open(url, '_blank')\r\n}\r\n\r\nfunction pokemonLabel (name, rarity, types, disappearTime, id, latitude, longitude, encounterId, ivAttack, ivDefense, ivStamina, move1, move2) {\r\n  var disappearDate = new Date(disappearTime)\r\n  var rarityDisplay = rarity ? '(' + rarity + ')' : ''\r\n  var typesDisplay = ''\r\n  $.each(types, function (index, type) {\r\n    typesDisplay += getTypeSpan(type)\r\n  })\r\n\r\n  var ivstring = ''\r\n  if (ivAttack != null) {\r\n    var perfect = ((ivAttack + ivDefense + ivStamina) / 45 * 100).toFixed(1) + '%'\r\n    ivstring = `\r\n      <div>\r\n        Attack: ${ivAttack}, Defense: ${ivDefense}, Stamina: ${ivStamina}, Perfection: ${perfect}\r\n      </div>`\r\n  }\r\n\r\n  var moveString = ''\r\n  if (move1 != null){\r\n    moveString = `\r\n      <div>\r\n        Move 1: ${moves[move1]}, Move 2: ${moves[move2]}\r\n      </div>\r\n    `\r\n  }\r\n\r\n  var contentstring = `\r\n    <div>\r\n      <b>${name}</b>\r\n      <span> - </span>\r\n      <small>\r\n        <a href='http://www.pokemon.com/us/pokedex/${id}' target='_blank' title='View in Pokedex'>#${id}</a>\r\n      </small>\r\n      <span> ${rarityDisplay}</span>\r\n      <span> - </span>\r\n      <small>${typesDisplay}</small>\r\n    </div>\r\n    ${ivstring}\r\n    ${moveString}\r\n    <div>\r\n      Disappears at ${pad(disappearDate.getHours())}:${pad(disappearDate.getMinutes())}:${pad(disappearDate.getSeconds())}\r\n      <span class='label-countdown' disappears-at='${disappearTime}'>(00m00s)</span>\r\n    </div>\r\n    <div>\r\n      Location: ${latitude.toFixed(6)}, ${longitude.toFixed(7)}\r\n    </div>\r\n    <div>\r\n      <a href='javascript:excludePokemon(${id})'>Exclude</a>&nbsp;&nbsp\r\n      <a href='javascript:notifyAboutPokemon(${id})'>Notify</a>&nbsp;&nbsp\r\n      <a href='javascript:removePokemonMarker(\"${encounterId}\")'>Remove</a>&nbsp;&nbsp\r\n      <a href='javascript:void(0);' onclick='javascript:openMapDirections(${latitude},${longitude});' title='View in Maps'>Get directions</a>\r\n    </div>`\r\n  return contentstring\r\n}\r\n\r\nfunction gymLabel (teamName, teamId, gymPoints, latitude, longitude, lastScanned = null, name = null, members = []) {\r\n  var memberStr = ''\r\n  for (var i = 0; i < members.length; i++) {\r\n    memberStr += `\r\n      <span class=\"gym-member\" title=\"${members[i].pokemon_name} | ${members[i].trainer_name} (Lvl ${members[i].trainer_level})\">\r\n        <i class=\"pokemon-sprite n${members[i].pokemon_id}\"></i>\r\n        <span class=\"cp team-${teamId}\">${members[i].pokemon_cp}</span>\r\n      </span>`\r\n  }\r\n\r\n  var lastScannedStr\r\n  if (lastScanned) {\r\n    var lastScannedDate = new Date(lastScanned)\r\n    lastScannedStr = `${lastScannedDate.getFullYear()}-${pad(lastScannedDate.getMonth() + 1)}-${pad(lastScannedDate.getDate())} ${pad(lastScannedDate.getHours())}:${pad(lastScannedDate.getMinutes())}:${pad(lastScannedDate.getSeconds())}`\r\n  } else {\r\n    lastScannedStr = 'Unknown'\r\n  }\r\n\r\n  var nameStr = (name ? `<div>${name}</div>` : '')\r\n\r\n  var gymColor = ['0, 0, 0, .4', '74, 138, 202, .6', '240, 68, 58, .6', '254, 217, 40, .6']\r\n  var str\r\n  if (teamId === 0) {\r\n    str = `\r\n      <div>\r\n        <center>\r\n          <div>\r\n            <b style='color:rgba(${gymColor[teamId]})'>${teamName}</b><br>\r\n            <img height='70px' style='padding: 5px;' src='static/forts/${teamName}_large.png'>\r\n          </div>\r\n          ${nameStr}\r\n          <div>\r\n            Location: ${latitude.toFixed(6)}, ${longitude.toFixed(7)}\r\n          </div>\r\n          <div>\r\n            Last Scanned: ${lastScannedStr}\r\n          </div>\r\n          <div>\r\n            <a href='javascript:void(0);' onclick='javascript:openMapDirections(${latitude},${longitude});' title='View in Maps'>Get directions</a>\r\n          </div>\r\n        </center>\r\n      </div>`\r\n  } else {\r\n    var gymPrestige = [2000, 4000, 8000, 12000, 16000, 20000, 30000, 40000, 50000]\r\n    var gymLevel = 1\r\n    while (gymPoints >= gymPrestige[gymLevel - 1]) {\r\n      gymLevel++\r\n    }\r\n    str = `\r\n      <div>\r\n        <center>\r\n          <div style='padding-bottom: 2px'>\r\n            Gym owned by:\r\n          </div>\r\n          <div>\r\n            <b style='color:rgba(${gymColor[teamId]})'>Team ${teamName}</b><br>\r\n            <img height='70px' style='padding: 5px;' src='static/forts/${teamName}_large.png'>\r\n          </div>\r\n          <div>\r\n            ${nameStr}\r\n          </div>\r\n          <div>\r\n            Level: ${gymLevel} | Prestige: ${gymPoints}/${gymPrestige[gymLevel - 1] || 50000}\r\n          </div>\r\n          <div>\r\n            ${memberStr}\r\n          </div>\r\n          <div>\r\n            Location: ${latitude.toFixed(6)}, ${longitude.toFixed(7)}\r\n          </div>\r\n          <div>\r\n            Last Scanned: ${lastScannedStr}\r\n          </div>\r\n          <div>\r\n            <a href='javascript:void(0);' onclick='javascript:openMapDirections(${latitude},${longitude});' title='View in Maps'>Get directions</a>\r\n          </div>\r\n        </center>\r\n      </div>`\r\n  }\r\n\r\n  return str\r\n}\r\n\r\nfunction pokestopLabel (expireTime, latitude, longitude) {\r\n  var str\r\n  if (expireTime) {\r\n    var expireDate = new Date(expireTime)\r\n\r\n    str = `\r\n      <div>\r\n        <b>Lured Pokstop</b>\r\n      </div>\r\n      <div>\r\n        Lure expires at ${pad(expireDate.getHours())}:${pad(expireDate.getMinutes())}:${pad(expireDate.getSeconds())}\r\n        <span class='label-countdown' disappears-at='${expireTime}'>(00m00s)</span>\r\n      </div>\r\n      <div>\r\n        Location: ${latitude.toFixed(6)}, ${longitude.toFixed(7)}\r\n      </div>\r\n      <div>\r\n        <a href='javascript:void(0);' onclick='javascript:openMapDirections(${latitude},${longitude});' title='View in Maps'>Get directions</a>\r\n      </div>`\r\n  } else {\r\n    str = `\r\n      <div>\r\n        <b>Pokstop</b>\r\n      </div>\r\n      <div>\r\n        Location: ${latitude.toFixed(6)}, ${longitude.toFixed(7)}\r\n      </div>\r\n      <div>\r\n        <a href='javascript:void(0);' onclick='javascript:openMapDirections(${latitude},${longitude});' title='View in Maps'>Get directions</a>\r\n      </div>`\r\n  }\r\n\r\n  return str\r\n}\r\n\r\nfunction formatSpawnTime (seconds) {\r\n  // the addition and modulo are required here because the db stores when a spawn disappears\r\n  // the subtraction to get the appearance time will knock seconds under 0 if the spawn happens in the previous hour\r\n  return ('0' + Math.floor(((seconds + 3600) % 3600) / 60)).substr(-2) + ':' + ('0' + seconds % 60).substr(-2)\r\n}\r\nfunction spawnpointLabel (item) {\r\n  var str = `\r\n    <div>\r\n      <b>Spawn Point</b>\r\n    </div>\r\n    <div>\r\n      Every hour from ${formatSpawnTime(item.time)} to ${formatSpawnTime(item.time + 900)}\r\n    </div>`\r\n\r\n  if (item.special) {\r\n    str += `\r\n      <div>\r\n        May appear as early as ${formatSpawnTime(item.time - 1800)}\r\n      </div>`\r\n  }\r\n  return str\r\n}\r\n\r\nfunction addRangeCircle (marker, map, type, teamId) {\r\n  var targetmap = null\r\n  var circleCenter = new google.maps.LatLng(marker.position.lat(), marker.position.lng())\r\n  var gymColors = ['#999999', '#0051CF', '#FF260E', '#FECC23'] // 'Uncontested', 'Mystic', 'Valor', 'Instinct']\r\n  var teamColor = gymColors[0]\r\n  if (teamId) teamColor = gymColors[teamId]\r\n\r\n  var range\r\n  var circleColor\r\n\r\n  // handle each type of marker and be explicit about the range circle attributes\r\n  switch (type) {\r\n    case 'pokemon':\r\n      circleColor = '#C233F2'\r\n      range = 40 // pokemon appear at 40m and then you can move away. still have to be 40m close to see it though, so ignore the further disappear distance\r\n      break\r\n    case 'pokestop':\r\n      circleColor = '#3EB0FF'\r\n      range = 40\r\n      break\r\n    case 'gym':\r\n      circleColor = teamColor\r\n      range = 40\r\n      break\r\n  }\r\n\r\n  if (map) targetmap = map\r\n\r\n  var rangeCircleOpts = {\r\n    map: targetmap,\r\n    radius: range, // meters\r\n    strokeWeight: 1,\r\n    strokeColor: circleColor,\r\n    strokeOpacity: 0.9,\r\n    center: circleCenter,\r\n    fillColor: circleColor,\r\n    fillOpacity: 0.3\r\n  }\r\n  var rangeCircle = new google.maps.Circle(rangeCircleOpts)\r\n  return rangeCircle\r\n}\r\n\r\nfunction isRangeActive (map) {\r\n  if (map.getZoom() < 16) return false\r\n  return Store.get('showRanges')\r\n}\r\n\r\nfunction customizePokemonMarker (marker, item, skipNotification) {\r\n  // Scale icon size up with the map exponentially\r\n  var iconSize = 2 + (map.getZoom() - 3) * (map.getZoom() - 3) * 0.2 + Store.get('iconSizeModifier')\r\n  var pokemonIndex = item['pokemon_id'] - 1\r\n  var sprite = pokemonSprites[Store.get('pokemonIcons')] || pokemonSprites['highres']\r\n  var icon = getGoogleSprite(pokemonIndex, sprite, iconSize)\r\n  //console.log(item);\r\n\r\n  var animationDisabled = false\r\n  // if (isBounceDisabled === true) {\r\n  //   animationDisabled = true\r\n  // }\r\n\r\n  var marker = new google.maps.Marker({\r\n    position: {\r\n      lat: item['latitude'],\r\n      lng: item['longitude']\r\n    },\r\n    zIndex: 9999,\r\n    map: map,\r\n    icon: icon,\r\n    animationDisabled: animationDisabled\r\n  })\r\n\r\n  marker.addListener('click', function () {\r\n    this.setAnimation(null)\r\n    this.animationDisabled = true\r\n  })\r\n\r\n  if (!marker.rangeCircle && isRangeActive(map)) {\r\n    marker.rangeCircle = addRangeCircle(marker, map, 'pokemon')\r\n  }\r\n\r\n  marker.infoWindow = new google.maps.InfoWindow({\r\n    content: pokemonLabel(item['pokemon_name'], item['pokemon_rarity'], item['pokemon_types'], item['disappear_time'], item['pokemon_id'], item['latitude'], item['longitude'], item['encounter_id'], item['iv_attack'], item['iv_defense'], item['iv_stamina'], item['move_1'], item['move_2']),\r\n    disableAutoPan: true\r\n  })\r\n\r\n  if (notifiedPokemon.indexOf(item['pokemon_id']) > -1 || notifiedRarity.indexOf(item['pokemon_rarity']) > -1) {\r\n    if (!skipNotification) {\r\n      if (Store.get('playSound')) {\r\n        audio.play()\r\n      }\r\n      sendNotification('A wild ' + item['pokemon_name'] + ' appeared!', 'Click to load map', 'static/icons/' + item['pokemon_id'] + '.png', item['latitude'], item['longitude'])\r\n    }\r\n    if (marker.animationDisabled !== true) {\r\n      marker.setAnimation(google.maps.Animation.BOUNCE)\r\n    }\r\n  }\r\n  if (item['iv_attack'] != null) {\r\n    var perfection = 100.0 * (item['iv_attack'] + item['iv_defense'] + item['iv_stamina']) / 45\r\n    if (notifiedMinPerfection > 0 && perfection >= notifiedMinPerfection) {\r\n      if (!skipNotification) {\r\n        if (Store.get('playSound')) {\r\n          audio.play()\r\n        }\r\n        sendNotification('A ' + perfection.toFixed(1) + '% perfect ' + item['pokemon_name'] + ' appeared!', 'Click to load map', 'static/icons/' + item['pokemon_id'] + '.png', item['latitude'], item['longitude'])\r\n      }\r\n      if (marker.animationDisabled !== true) {\r\n        marker.setAnimation(google.maps.Animation.BOUNCE)\r\n      }\r\n    }\r\n  }\r\n\r\n  addListeners(marker)\r\n}\r\n\r\nfunction setupGymMarker (item) {\r\n  var marker = new google.maps.Marker({\r\n    position: {\r\n      lat: item['latitude'],\r\n      lng: item['longitude']\r\n    },\r\n    map: map,\r\n    icon: 'static/forts/' + gymTypes[item['team_id']] + '.png'\r\n  })\r\n\r\n  if (!marker.rangeCircle && isRangeActive(map)) {\r\n    marker.rangeCircle = addRangeCircle(marker, map, 'gym', item['team_id'])\r\n  }\r\n\r\n  marker.infoWindow = new google.maps.InfoWindow({\r\n    content: gymLabel(gymTypes[item['team_id']], item['team_id'], item['gym_points'], item['latitude'], item['longitude'], item['last_scanned'], item['name'], item['pokemon']),\r\n    disableAutoPan: true\r\n  })\r\n\r\n  addListeners(marker)\r\n  return marker\r\n}\r\n\r\nfunction updateGymMarker (item, marker) {\r\n  marker.setIcon('static/forts/' + gymTypes[item['team_id']] + '.png')\r\n  marker.infoWindow.setContent(gymLabel(gymTypes[item['team_id']], item['team_id'], item['gym_points'], item['latitude'], item['longitude'], item['last_scanned'], item['name'], item['pokemon']))\r\n  return marker\r\n}\r\n\r\nfunction setupPokestopMarker (item) {\r\n  var imagename = item['lure_expiration'] ? 'PstopLured' : 'Pstop'\r\n  var marker = new google.maps.Marker({\r\n    position: {\r\n      lat: item['latitude'],\r\n      lng: item['longitude']\r\n    },\r\n    map: map,\r\n    zIndex: 2,\r\n    icon: 'static/forts/' + imagename + '.png'\r\n  })\r\n\r\n  if (!marker.rangeCircle && isRangeActive(map)) {\r\n    marker.rangeCircle = addRangeCircle(marker, map, 'pokestop')\r\n  }\r\n\r\n  marker.infoWindow = new google.maps.InfoWindow({\r\n    content: pokestopLabel(item['lure_expiration'], item['latitude'], item['longitude']),\r\n    disableAutoPan: true\r\n  })\r\n\r\n  addListeners(marker)\r\n  return marker\r\n}\r\n\r\nfunction getColorByDate (value) {\r\n  // Changes the color from red to green over 15 mins\r\n  var diff = (Date.now() - value) / 1000 / 60 / 15\r\n\r\n  if (diff > 1) {\r\n    diff = 1\r\n  }\r\n\r\n  // value from 0 to 1 - Green to Red\r\n  var hue = ((1 - diff) * 120).toString(10)\r\n  return ['hsl(', hue, ',100%,50%)'].join('')\r\n}\r\n\r\nfunction setupScannedMarker (item) {\r\n  var circleCenter = new google.maps.LatLng(item['latitude'], item['longitude'])\r\n\r\n  var marker = new google.maps.Circle({\r\n    map: map,\r\n    clickable: false,\r\n    center: circleCenter,\r\n    radius: 70, // metres\r\n    fillColor: getColorByDate(item['last_modified']),\r\n    fillOpacity: 0.1,\r\n    strokeWeight: 1,\r\n    strokeOpacity: 0.5\r\n  })\r\n\r\n  return marker\r\n}\r\n\r\nfunction getColorBySpawnTime (value) {\r\n  var now = new Date()\r\n  var seconds = now.getMinutes() * 60 + now.getSeconds()\r\n\r\n  // account for hour roll-over\r\n  if (seconds < 900 && value > 2700) {\r\n    seconds += 3600\r\n  } else if (seconds > 2700 && value < 900) {\r\n    value += 3600\r\n  }\r\n\r\n  var diff = (seconds - value)\r\n  var hue = 275 // light purple when spawn is neither about to spawn nor active\r\n  if (diff >= 0 && diff <= 900) { // green to red over 15 minutes of active spawn\r\n    hue = (1 - (diff / 60 / 15)) * 120\r\n  } else if (diff < 0 && diff > -300) { // light blue to dark blue over 5 minutes til spawn\r\n    hue = ((1 - (-diff / 60 / 5)) * 50) + 200\r\n  }\r\n\r\n  hue = Math.round(hue / 5) * 5\r\n\r\n  return hue\r\n}\r\n\r\nfunction changeSpawnIcon (color, zoom) {\r\n  var urlColor = ''\r\n  if (color === 275) {\r\n    urlColor = './static/icons/hsl-275-light.png'\r\n  } else {\r\n    urlColor = './static/icons/hsl-' + color + '.png'\r\n  }\r\n  var zoomScale = 1.6 // adjust this value to change the size of the spawnpoint icons\r\n  var minimumSize = 1\r\n  var newSize = Math.round(zoomScale * (zoom - 10)) // this scales the icon based on zoom\r\n  if (newSize < minimumSize) {\r\n    newSize = minimumSize\r\n  }\r\n\r\n  var newIcon = {\r\n    url: urlColor,\r\n    scaledSize: new google.maps.Size(newSize, newSize),\r\n    anchor: new google.maps.Point(newSize / 2, newSize / 2)\r\n  }\r\n\r\n  return newIcon\r\n}\r\n\r\nfunction spawnPointIndex (color) {\r\n  var newIndex = 1\r\n  var scale = 0\r\n  if (color >= 0 && color <= 120) { // high to low over 15 minutes of active spawn\r\n    scale = color / 120\r\n    newIndex = 100 + scale * 100\r\n  } else if (color >= 200 && color <= 250) { // low to high over 5 minutes til spawn\r\n    scale = (color - 200) / 50\r\n    newIndex = scale * 100\r\n  }\r\n\r\n  return newIndex\r\n}\r\n\r\nfunction setupSpawnpointMarker (item) {\r\n  var circleCenter = new google.maps.LatLng(item['latitude'], item['longitude'])\r\n  var hue = getColorBySpawnTime(item.time)\r\n  var zoom = map.getZoom()\r\n\r\n  var marker = new google.maps.Marker({\r\n    map: map,\r\n    position: circleCenter,\r\n    icon: changeSpawnIcon(hue, zoom),\r\n    zIndex: spawnPointIndex(hue)\r\n  })\r\n\r\n  marker.infoWindow = new google.maps.InfoWindow({\r\n    content: spawnpointLabel(item),\r\n    disableAutoPan: true,\r\n    position: circleCenter\r\n  })\r\n\r\n  addListeners(marker)\r\n\r\n  return marker\r\n}\r\n\r\nfunction clearSelection () {\r\n  if (document.selection) {\r\n    document.selection.empty()\r\n  } else if (window.getSelection) {\r\n    window.getSelection().removeAllRanges()\r\n  }\r\n}\r\n\r\nfunction addListeners (marker) {\r\n  marker.addListener('click', function () {\r\n    marker.infoWindow.open(map, marker)\r\n    clearSelection()\r\n    updateLabelDiffTime()\r\n    marker.persist = true\r\n  })\r\n\r\n  google.maps.event.addListener(marker.infoWindow, 'closeclick', function () {\r\n    marker.persist = null\r\n  })\r\n\r\n  marker.addListener('mouseover', function () {\r\n    marker.infoWindow.open(map, marker)\r\n    clearSelection()\r\n    updateLabelDiffTime()\r\n  })\r\n\r\n  marker.addListener('mouseout', function () {\r\n    if (!marker.persist) {\r\n      marker.infoWindow.close()\r\n    }\r\n  })\r\n\r\n  return marker\r\n}\r\n\r\nfunction clearStaleMarkers () {\r\n  $.each(mapData.pokemons, function (key, value) {\r\n    if (mapData.pokemons[key]['disappear_time'] < new Date().getTime() ||\r\n      excludedPokemon.indexOf(mapData.pokemons[key]['pokemon_id']) >= 0) {\r\n      if (mapData.pokemons[key].marker.rangeCircle) {\r\n        mapData.pokemons[key].marker.rangeCircle.setMap(null)\r\n        delete mapData.pokemons[key].marker.rangeCircle\r\n      }\r\n      mapData.pokemons[key].marker.setMap(null)\r\n      delete mapData.pokemons[key]\r\n    }\r\n  })\r\n\r\n  $.each(mapData.lurePokemons, function (key, value) {\r\n    if (mapData.lurePokemons[key]['lure_expiration'] < new Date().getTime() ||\r\n      excludedPokemon.indexOf(mapData.lurePokemons[key]['pokemon_id']) >= 0) {\r\n      mapData.lurePokemons[key].marker.setMap(null)\r\n      delete mapData.lurePokemons[key]\r\n    }\r\n  })\r\n\r\n  $.each(mapData.scanned, function (key, value) {\r\n    // If older than 15mins remove\r\n    if (mapData.scanned[key]['last_modified'] < (new Date().getTime() - 15 * 60 * 1000)) {\r\n      mapData.scanned[key].marker.setMap(null)\r\n      delete mapData.scanned[key]\r\n    }\r\n  })\r\n}\r\n\r\nfunction showInBoundsMarkers (markers, type) {\r\n  $.each(markers, function (key, value) {\r\n    var marker = markers[key].marker\r\n    var show = false\r\n    if (!markers[key].hidden) {\r\n      if (typeof marker.getBounds === 'function') {\r\n        if (map.getBounds().intersects(marker.getBounds())) {\r\n          show = true\r\n        }\r\n      } else if (typeof marker.getPosition === 'function') {\r\n        if (map.getBounds().contains(marker.getPosition())) {\r\n          show = true\r\n        }\r\n      }\r\n    }\r\n    // marker has an associated range\r\n    if (show && rangeMarkers.indexOf(type) !== -1) {\r\n      // no range circle yet...let's create one\r\n      if (!marker.rangeCircle) {\r\n        // but only if range is active\r\n        if (isRangeActive(map)) {\r\n          if (type === 'gym') marker.rangeCircle = addRangeCircle(marker, map, type, markers[key].team_id)\r\n          else marker.rangeCircle = addRangeCircle(marker, map, type)\r\n        }\r\n      } else { // there's already a range circle\r\n        if (isRangeActive(map)) {\r\n          marker.rangeCircle.setMap(map)\r\n        } else {\r\n          marker.rangeCircle.setMap(null)\r\n        }\r\n      }\r\n    }\r\n\r\n    if (show && !marker.getMap()) {\r\n      marker.setMap(map)\r\n      // Not all markers can be animated (ex: scan locations)\r\n      if (marker.setAnimation && marker.oldAnimation) {\r\n        marker.setAnimation(marker.oldAnimation)\r\n      }\r\n    } else if (!show && marker.getMap()) {\r\n      // Not all markers can be animated (ex: scan locations)\r\n      if (marker.getAnimation) {\r\n        marker.oldAnimation = marker.getAnimation()\r\n      }\r\n      if (marker.rangeCircle) marker.rangeCircle.setMap(null)\r\n      marker.setMap(null)\r\n    }\r\n  })\r\n}\r\n\r\nfunction loadRawData () {\r\n  var loadPokemon = Store.get('showPokemon')\r\n  var loadGyms = Store.get('showGyms')\r\n  var loadPokestops = Store.get('showPokestops')\r\n  var loadScanned = Store.get('showScanned')\r\n  var loadSpawnpoints = Store.get('showSpawnpoints')\r\n\r\n  var bounds = map.getBounds()\r\n  var swPoint = bounds.getSouthWest()\r\n  var nePoint = bounds.getNorthEast()\r\n  var swLat = swPoint.lat()\r\n  var swLng = swPoint.lng()\r\n  var neLat = nePoint.lat()\r\n  var neLng = nePoint.lng()\r\n\r\n  return $.ajax({\r\n    url: 'raw_data',\r\n    type: 'GET',\r\n    data: {\r\n      'pokemon': loadPokemon,\r\n      'pokestops': loadPokestops,\r\n      'gyms': loadGyms,\r\n      'scanned': loadScanned,\r\n      'spawnpoints': loadSpawnpoints,\r\n      'swLat': swLat,\r\n      'swLng': swLng,\r\n      'neLat': neLat,\r\n      'neLng': neLng\r\n    },\r\n    dataType: 'json',\r\n    cache: false,\r\n    beforeSend: function () {\r\n      if (rawDataIsLoading) {\r\n        return false\r\n      } else {\r\n        rawDataIsLoading = true\r\n      }\r\n    },\r\n    complete: function () {\r\n      rawDataIsLoading = false\r\n    }\r\n  })\r\n}\r\n\r\nfunction processPokemons (i, item) {\r\n  if (!Store.get('showPokemon')) {\r\n    return false // in case the checkbox was unchecked in the meantime.\r\n  }\r\n\r\n  var encounterId = item['encounter_id']\r\n  if ((!(encounterId in mapData.pokemons) ||\r\n       mapData.pokemons[encounterId]['iv_attack'] !== item['iv_attack']) &&\r\n      excludedPokemon.indexOf(item['pokemon_id']) < 0) {\r\n    // add marker to map and item to dict\r\n    if (item.marker) {\r\n      item.marker.setMap(null)\r\n    }\r\n    var oldMarker = mapData.pokemons[encounterId]\r\n    if (oldMarker != null) {\r\n      if (oldMarker.marker.rangeCircle) {\r\n        oldMarker.marker.rangeCircle.setMap(null)\r\n        delete oldMarker.marker.rangeCircle\r\n      }\r\n      oldMarker.marker.setMap(null)\r\n      delete mapData.pokemons[encounterId].marker\r\n    }\r\n    if (!item.hidden) {\r\n      item.marker = setupPokemonMarker(item, map)\r\n      customizePokemonMarker(item.marker, item)\r\n      mapData.pokemons[item['encounter_id']] = item\r\n      //item.marker = setupPokemonMarker(item)\r\n      //mapData.pokemons[encounterId] = item\r\n    }\r\n  }\r\n}\r\n\r\nfunction processPokestops (i, item) {\r\n  if (!Store.get('showPokestops')) {\r\n    return false\r\n  }\r\n\r\n  if (Store.get('showLuredPokestopsOnly') && !item['lure_expiration']) {\r\n    if (mapData.pokestops[item['pokestop_id']] && mapData.pokestops[item['pokestop_id']].marker) {\r\n      if (mapData.pokestops[item['pokestop_id']].marker.rangeCircle) {\r\n        mapData.pokestops[item['pokestop_id']].marker.rangeCircle.setMap(null)\r\n      }\r\n      mapData.pokestops[item['pokestop_id']].marker.setMap(null)\r\n      delete mapData.pokestops[item['pokestop_id']]\r\n    }\r\n    return true\r\n  }\r\n\r\n  if (!mapData.pokestops[item['pokestop_id']]) { // add marker to map and item to dict\r\n    // add marker to map and item to dict\r\n    if (item.marker && item.marker.rangeCircle) {\r\n      item.marker.rangeCircle.setMap(null)\r\n    }\r\n    if (item.marker) {\r\n      item.marker.setMap(null)\r\n    }\r\n    item.marker = setupPokestopMarker(item)\r\n    mapData.pokestops[item['pokestop_id']] = item\r\n  } else {\r\n    var item2 = mapData.pokestops[item['pokestop_id']]\r\n    if (!!item['lure_expiration'] !== !!item2['lure_expiration']) {\r\n      if (item2.marker && item2.marker.rangeCircle) {\r\n        item2.marker.rangeCircle.setMap(null)\r\n      }\r\n      item2.marker.setMap(null)\r\n      item.marker = setupPokestopMarker(item)\r\n      mapData.pokestops[item['pokestop_id']] = item\r\n    }\r\n  }\r\n}\r\n\r\nfunction processGyms (i, item) {\r\n  if (!Store.get('showGyms')) {\r\n    return false // in case the checkbox was unchecked in the meantime.\r\n  }\r\n\r\n  if (item['gym_id'] in mapData.gyms) {\r\n    item.marker = updateGymMarker(item, mapData.gyms[item['gym_id']].marker)\r\n  } else { // add marker to map and item to dict\r\n    item.marker = setupGymMarker(item)\r\n  }\r\n  mapData.gyms[item['gym_id']] = item\r\n}\r\n\r\nfunction processScanned (i, item) {\r\n  if (!Store.get('showScanned')) {\r\n    return false\r\n  }\r\n\r\n  var scanId = item['latitude'] + '|' + item['longitude']\r\n\r\n  if (scanId in mapData.scanned) {\r\n    mapData.scanned[scanId].marker.setOptions({\r\n      fillColor: getColorByDate(item['last_modified'])\r\n    })\r\n  } else { // add marker to map and item to dict\r\n    if (item.marker) {\r\n      item.marker.setMap(null)\r\n    }\r\n    item.marker = setupScannedMarker(item)\r\n    mapData.scanned[scanId] = item\r\n  }\r\n}\r\n\r\nfunction processSpawnpoints (i, item) {\r\n  if (!Store.get('showSpawnpoints')) {\r\n    return false\r\n  }\r\n\r\n  var id = item['spawnpoint_id']\r\n  var zoom = map.getZoom()\r\n\r\n  if (id in mapData.spawnpoints) {\r\n    var hue = getColorBySpawnTime(item['time'])\r\n    mapData.spawnpoints[id].marker.setIcon(changeSpawnIcon(hue, zoom))\r\n    mapData.spawnpoints[id].marker.setZIndex(spawnPointIndex(hue))\r\n  } else { // add marker to map and item to dict\r\n    if (item.marker) {\r\n      item.marker.setMap(null)\r\n    }\r\n    item.marker = setupSpawnpointMarker(item)\r\n    mapData.spawnpoints[id] = item\r\n  }\r\n}\r\n\r\nfunction updateMap () {\r\n  loadRawData().done(function (result) {\r\n    $.each(result.pokemons, processPokemons)\r\n    $.each(result.pokestops, processPokestops)\r\n    $.each(result.gyms, processGyms)\r\n    $.each(result.scanned, processScanned)\r\n    $.each(result.spawnpoints, processSpawnpoints)\r\n    showInBoundsMarkers(mapData.pokemons, 'pokemon')\r\n    showInBoundsMarkers(mapData.lurePokemons, 'pokemon')\r\n    showInBoundsMarkers(mapData.gyms, 'gym')\r\n    showInBoundsMarkers(mapData.pokestops, 'pokestop')\r\n    showInBoundsMarkers(mapData.scanned, 'scanned')\r\n    showInBoundsMarkers(mapData.spawnpoints, 'inbound')\r\n//    drawScanPath(result.scanned);\r\n    clearStaleMarkers()\r\n    if ($('#stats').hasClass('visible')) {\r\n      countMarkers()\r\n    }\r\n  })\r\n}\r\n\r\nfunction drawScanPath (points) { // eslint-disable-line no-unused-vars\r\n  var scanPathPoints = []\r\n  $.each(points, function (idx, point) {\r\n    scanPathPoints.push({lat: point['latitude'], lng: point['longitude']})\r\n  })\r\n  if (scanPath) {\r\n    scanPath.setMap(null)\r\n  }\r\n  scanPath = new google.maps.Polyline({\r\n    path: scanPathPoints,\r\n    geodesic: true,\r\n    strokeColor: '#FF0000',\r\n    strokeOpacity: 1.0,\r\n    strokeWeight: 2,\r\n    map: map\r\n  })\r\n}\r\n\r\nfunction redrawPokemon (pokemonList) {\r\n  var skipNotification = true\r\n  $.each(pokemonList, function (key, value) {\r\n    var item = pokemonList[key]\r\n    if (!item.hidden) {\r\n      if (item.marker.rangeCircle) item.marker.rangeCircle.setMap(null)\r\n      var newMarker = setupPokemonMarker(item, map, this.marker.animationDisabled)\r\n      customizePokemonMarker(newMarker, item, skipNotification)\r\n      item.marker.setMap(null)\r\n      pokemonList[key].marker = newMarker\r\n    }\r\n  })\r\n}\r\n\r\nvar updateLabelDiffTime = function () {\r\n  $('.label-countdown').each(function (index, element) {\r\n    var disappearsAt = new Date(parseInt(element.getAttribute('disappears-at')))\r\n    var now = new Date()\r\n\r\n    var difference = Math.abs(disappearsAt - now)\r\n    var hours = Math.floor(difference / 36e5)\r\n    var minutes = Math.floor((difference - (hours * 36e5)) / 6e4)\r\n    var seconds = Math.floor((difference - (hours * 36e5) - (minutes * 6e4)) / 1e3)\r\n    var timestring = ''\r\n\r\n    if (disappearsAt < now) {\r\n      timestring = '(expired)'\r\n    } else {\r\n      timestring = '('\r\n      if (hours > 0) {\r\n        timestring = hours + 'h'\r\n      }\r\n\r\n      timestring += ('0' + minutes).slice(-2) + 'm'\r\n      timestring += ('0' + seconds).slice(-2) + 's'\r\n      timestring += ')'\r\n    }\r\n\r\n    $(element).text(timestring)\r\n  })\r\n}\r\n\r\nfunction getPointDistance (pointA, pointB) {\r\n  return google.maps.geometry.spherical.computeDistanceBetween(pointA, pointB)\r\n}\r\n\r\nfunction sendNotification (title, text, icon, lat, lng) {\r\n  if (!('Notification' in window)) {\r\n    return false // Notifications are not present in browser\r\n  }\r\n\r\n  if (Notification.permission !== 'granted') {\r\n    Notification.requestPermission()\r\n  } else {\r\n    var notification = new Notification(title, {\r\n      icon: icon,\r\n      body: text,\r\n      sound: 'sounds/ding.mp3'\r\n    })\r\n\r\n    notification.onclick = function () {\r\n      window.focus()\r\n      notification.close()\r\n\r\n      centerMap(lat, lng, 20)\r\n    }\r\n  }\r\n}\r\n\r\nfunction createMyLocationButton () {\r\n  var locationContainer = document.createElement('div')\r\n\r\n  var locationButton = document.createElement('button')\r\n  locationButton.style.backgroundColor = '#fff'\r\n  locationButton.style.border = 'none'\r\n  locationButton.style.outline = 'none'\r\n  locationButton.style.width = '28px'\r\n  locationButton.style.height = '28px'\r\n  locationButton.style.borderRadius = '2px'\r\n  locationButton.style.boxShadow = '0 1px 4px rgba(0,0,0,0.3)'\r\n  locationButton.style.cursor = 'pointer'\r\n  locationButton.style.marginRight = '10px'\r\n  locationButton.style.padding = '0px'\r\n  locationButton.title = 'My Location'\r\n  locationContainer.appendChild(locationButton)\r\n\r\n  var locationIcon = document.createElement('div')\r\n  locationIcon.style.margin = '5px'\r\n  locationIcon.style.width = '18px'\r\n  locationIcon.style.height = '18px'\r\n  locationIcon.style.backgroundImage = 'url(static/mylocation-sprite-1x.png)'\r\n  locationIcon.style.backgroundSize = '180px 18px'\r\n  locationIcon.style.backgroundPosition = '0px 0px'\r\n  locationIcon.style.backgroundRepeat = 'no-repeat'\r\n  locationIcon.id = 'current-location'\r\n  locationButton.appendChild(locationIcon)\r\n\r\n  locationButton.addEventListener('click', function () {\r\n    centerMapOnLocation()\r\n  })\r\n\r\n  locationContainer.index = 1\r\n  map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(locationContainer)\r\n\r\n  google.maps.event.addListener(map, 'dragend', function () {\r\n    var currentLocation = document.getElementById('current-location')\r\n    currentLocation.style.backgroundPosition = '0px 0px'\r\n  })\r\n}\r\n\r\nfunction centerMapOnLocation () {\r\n  var currentLocation = document.getElementById('current-location')\r\n  var imgX = '0'\r\n  var animationInterval = setInterval(function () {\r\n    if (imgX === '-18') {\r\n      imgX = '0'\r\n    } else {\r\n      imgX = '-18'\r\n    }\r\n    currentLocation.style.backgroundPosition = imgX + 'px 0'\r\n  }, 500)\r\n  if (navigator.geolocation) {\r\n    navigator.geolocation.getCurrentPosition(function (position) {\r\n      var latlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude)\r\n      locationMarker.setPosition(latlng)\r\n      map.setCenter(latlng)\r\n      Store.set('followMyLocationPosition', { lat: position.coords.latitude, lng: position.coords.longitude })\r\n      clearInterval(animationInterval)\r\n      currentLocation.style.backgroundPosition = '-144px 0px'\r\n    })\r\n  } else {\r\n    clearInterval(animationInterval)\r\n    currentLocation.style.backgroundPosition = '0px 0px'\r\n  }\r\n}\r\n\r\nfunction changeLocation (lat, lng) {\r\n  var loc = new google.maps.LatLng(lat, lng)\r\n  changeSearchLocation(lat, lng).done(function () {\r\n    map.setCenter(loc)\r\n    searchMarker.setPosition(loc)\r\n  })\r\n}\r\n\r\nfunction changeSearchLocation (lat, lng) {\r\n  return $.post('next_loc?lat=' + lat + '&lon=' + lng, {})\r\n}\r\n\r\nfunction centerMap (lat, lng, zoom) {\r\n  var loc = new google.maps.LatLng(lat, lng)\r\n\r\n  map.setCenter(loc)\r\n\r\n  if (zoom) {\r\n    storeZoom = false\r\n    map.setZoom(zoom)\r\n  }\r\n}\r\n\r\nfunction i8ln (word) {\r\n  if ($.isEmptyObject(i8lnDictionary) && language !== 'en' && languageLookups < languageLookupThreshold) {\r\n    $.ajax({\r\n      url: 'static/dist/locales/' + language + '.min.json',\r\n      dataType: 'json',\r\n      async: false,\r\n      success: function (data) {\r\n        i8lnDictionary = data\r\n      },\r\n      error: function (jqXHR, status, error) {\r\n        console.log('Error loading i8ln dictionary: ' + error)\r\n        languageLookups++\r\n      }\r\n    })\r\n  }\r\n  if (word in i8lnDictionary) {\r\n    return i8lnDictionary[word]\r\n  } else {\r\n    // Word doesn't exist in dictionary return it as is\r\n    return word\r\n  }\r\n}\r\n\r\n//\r\n// Page Ready Exection\r\n//\r\n\r\n$(function () {\r\n  if (!Notification) {\r\n    console.log('could not load notifications')\r\n    return\r\n  }\r\n\r\n  if (Notification.permission !== 'granted') {\r\n    Notification.requestPermission()\r\n  }\r\n})\r\n\r\n$(function () {\r\n  // populate Navbar Style menu\r\n  $selectStyle = $('#map-style')\r\n\r\n  // Load Stylenames, translate entries, and populate lists\r\n  $.getJSON('static/dist/data/mapstyle.min.json').done(function (data) {\r\n    var styleList = []\r\n\r\n    $.each(data, function (key, value) {\r\n      styleList.push({\r\n        id: key,\r\n        text: i8ln(value)\r\n      })\r\n    })\r\n\r\n    // setup the stylelist\r\n    $selectStyle.select2({\r\n      placeholder: 'Select Style',\r\n      data: styleList,\r\n      minimumResultsForSearch: Infinity\r\n    })\r\n\r\n    // setup the list change behavior\r\n    $selectStyle.on('change', function (e) {\r\n      selectedStyle = $selectStyle.val()\r\n      map.setMapTypeId(selectedStyle)\r\n      Store.set('map_style', selectedStyle)\r\n    })\r\n\r\n    // recall saved mapstyle\r\n    $selectStyle.val(Store.get('map_style')).trigger('change')\r\n  })\r\n\r\n  $selectIconResolution = $('#pokemon-icons')\r\n\r\n  $selectIconResolution.select2({\r\n    placeholder: 'Select Icon Resolution',\r\n    minimumResultsForSearch: Infinity\r\n  })\r\n\r\n  $selectIconResolution.on('change', function () {\r\n    Store.set('pokemonIcons', this.value)\r\n    redrawPokemon(mapData.pokemons)\r\n    redrawPokemon(mapData.lurePokemons)\r\n  })\r\n\r\n  $selectIconSize = $('#pokemon-icon-size')\r\n\r\n  $selectIconSize.select2({\r\n    placeholder: 'Select Icon Size',\r\n    minimumResultsForSearch: Infinity\r\n  })\r\n\r\n  $selectIconSize.on('change', function () {\r\n    Store.set('iconSizeModifier', this.value)\r\n    redrawPokemon(mapData.pokemons)\r\n    redrawPokemon(mapData.lurePokemons)\r\n  })\r\n\r\n  $selectLuredPokestopsOnly = $('#lured-pokestops-only-switch')\r\n\r\n  $selectLuredPokestopsOnly.select2({\r\n    placeholder: 'Only Show Lured Pokestops',\r\n    minimumResultsForSearch: Infinity\r\n  })\r\n\r\n  $selectLuredPokestopsOnly.on('change', function () {\r\n    Store.set('showLuredPokestopsOnly', this.value)\r\n    updateMap()\r\n  })\r\n\r\n  $selectSearchIconMarker = $('#iconmarker-style')\r\n  $selectLocationIconMarker = $('#locationmarker-style')\r\n\r\n  $.getJSON('static/dist/data/searchmarkerstyle.min.json').done(function (data) {\r\n    searchMarkerStyles = data\r\n    var searchMarkerStyleList = []\r\n\r\n    $.each(data, function (key, value) {\r\n      searchMarkerStyleList.push({\r\n        id: key,\r\n        text: value.name\r\n      })\r\n    })\r\n\r\n    $selectSearchIconMarker.select2({\r\n      placeholder: 'Select Icon Marker',\r\n      data: searchMarkerStyleList,\r\n      minimumResultsForSearch: Infinity\r\n    })\r\n\r\n    $selectSearchIconMarker.on('change', function (e) {\r\n      var selectSearchIconMarker = $selectSearchIconMarker.val()\r\n      Store.set('searchMarkerStyle', selectSearchIconMarker)\r\n      updateSearchMarker(selectSearchIconMarker)\r\n    })\r\n\r\n    $selectSearchIconMarker.val(Store.get('searchMarkerStyle')).trigger('change')\r\n\r\n    updateSearchMarker(Store.get('lockMarker'))\r\n\r\n    $selectLocationIconMarker.select2({\r\n      placeholder: 'Select Location Marker',\r\n      data: searchMarkerStyleList,\r\n      minimumResultsForSearch: Infinity\r\n    })\r\n\r\n    $selectLocationIconMarker.on('change', function (e) {\r\n      Store.set('locationMarkerStyle', this.value)\r\n      updateLocationMarker(this.value)\r\n    })\r\n\r\n    $selectLocationIconMarker.val(Store.get('locationMarkerStyle')).trigger('change')\r\n  })\r\n})\r\n\r\n$(function () {\r\n  function formatState (state) {\r\n    if (!state.id) {\r\n      return state.text\r\n    }\r\n    var $state = $(\r\n      '<span><i class=\"pokemon-sprite n' + state.element.value.toString() + '\"></i> ' + state.text + '</span>'\r\n    )\r\n    return $state\r\n  }\r\n\r\n  if (Store.get('startAtUserLocation')) {\r\n    centerMapOnLocation()\r\n  }\r\n\r\n  $.getJSON('static/dist/data/moves.min.json').done(function (data) {\r\n    moves = data\r\n  })\r\n\r\n  $selectExclude = $('#exclude-pokemon')\r\n  $selectPokemonNotify = $('#notify-pokemon')\r\n  $selectRarityNotify = $('#notify-rarity')\r\n  $textPerfectionNotify = $('#notify-perfection')\r\n  var numberOfPokemon = 151\r\n\r\n  // Load pokemon names and populate lists\r\n  $.getJSON('static/dist/data/pokemon.min.json').done(function (data) {\r\n    var pokeList = []\r\n\r\n    $.each(data, function (key, value) {\r\n      if (key > numberOfPokemon) {\r\n        return false\r\n      }\r\n      var _types = []\r\n      pokeList.push({\r\n        id: key,\r\n        text: i8ln(value['name']) + ' - #' + key\r\n      })\r\n      value['name'] = i8ln(value['name'])\r\n      value['rarity'] = i8ln(value['rarity'])\r\n      $.each(value['types'], function (key, pokemonType) {\r\n        _types.push({\r\n          'type': i8ln(pokemonType['type']),\r\n          'color': pokemonType['color']\r\n        })\r\n      })\r\n      value['types'] = _types\r\n      idToPokemon[key] = value\r\n    })\r\n\r\n    // setup the filter lists\r\n    $selectExclude.select2({\r\n      placeholder: i8ln('Select Pokmon'),\r\n      data: pokeList,\r\n      templateResult: formatState\r\n    })\r\n    $selectPokemonNotify.select2({\r\n      placeholder: i8ln('Select Pokmon'),\r\n      data: pokeList,\r\n      templateResult: formatState\r\n    })\r\n    $selectRarityNotify.select2({\r\n      placeholder: i8ln('Select Rarity'),\r\n      data: [i8ln('Common'), i8ln('Uncommon'), i8ln('Rare'), i8ln('Very Rare'), i8ln('Ultra Rare')],\r\n      templateResult: formatState\r\n    })\r\n\r\n    // setup list change behavior now that we have the list to work from\r\n    $selectExclude.on('change', function (e) {\r\n      excludedPokemon = $selectExclude.val().map(Number)\r\n      clearStaleMarkers()\r\n      Store.set('remember_select_exclude', excludedPokemon)\r\n    })\r\n    $selectPokemonNotify.on('change', function (e) {\r\n      notifiedPokemon = $selectPokemonNotify.val().map(Number)\r\n      Store.set('remember_select_notify', notifiedPokemon)\r\n    })\r\n    $selectRarityNotify.on('change', function (e) {\r\n      notifiedRarity = $selectRarityNotify.val().map(String)\r\n      Store.set('remember_select_rarity_notify', notifiedRarity)\r\n    })\r\n    $textPerfectionNotify.on('change', function (e) {\r\n      notifiedMinPerfection = parseInt($textPerfectionNotify.val(), 10)\r\n      if (isNaN(notifiedMinPerfection) || notifiedMinPerfection <= 0) {\r\n        notifiedMinPerfection = ''\r\n      }\r\n      if (notifiedMinPerfection > 100) {\r\n        notifiedMinPerfection = 100\r\n      }\r\n      $textPerfectionNotify.val(notifiedMinPerfection)\r\n      Store.set('remember_text_perfection_notify', notifiedMinPerfection)\r\n    })\r\n\r\n    // recall saved lists\r\n    $selectExclude.val(Store.get('remember_select_exclude')).trigger('change')\r\n    $selectPokemonNotify.val(Store.get('remember_select_notify')).trigger('change')\r\n    $selectRarityNotify.val(Store.get('remember_select_rarity_notify')).trigger('change')\r\n    $textPerfectionNotify.val(Store.get('remember_text_perfection_notify')).trigger('change')\r\n\r\n    if (isTouchDevice()) {\r\n      $('.select2-search input').prop('readonly', true)\r\n    }\r\n  })\r\n\r\n  // run interval timers to regularly update map and timediffs\r\n  window.setInterval(updateLabelDiffTime, 1000)\r\n  window.setInterval(updateMap, 5000)\r\n  window.setInterval(function () {\r\n    if (navigator.geolocation && (Store.get('geoLocate') || Store.get('followMyLocation'))) {\r\n      navigator.geolocation.getCurrentPosition(function (position) {\r\n        var lat = position.coords.latitude\r\n        var lng = position.coords.longitude\r\n        var center = new google.maps.LatLng(lat, lng)\r\n\r\n        if (Store.get('geoLocate')) {\r\n          // the search function makes any small movements cause a loop. Need to increase resolution\r\n          if ((typeof searchMarker !== 'undefined') && (getPointDistance(searchMarker.getPosition(), center) > 40)) {\r\n            $.post('next_loc?lat=' + lat + '&lon=' + lng).done(function () {\r\n              map.panTo(center)\r\n              searchMarker.setPosition(center)\r\n            })\r\n          }\r\n        }\r\n        if (Store.get('followMyLocation')) {\r\n          if ((typeof locationMarker !== 'undefined') && (getPointDistance(locationMarker.getPosition(), center) >= 5)) {\r\n            map.panTo(center)\r\n            locationMarker.setPosition(center)\r\n            Store.set('followMyLocationPosition', { lat: lat, lng: lng })\r\n          }\r\n        }\r\n      })\r\n    }\r\n  }, 1000)\r\n\r\n  // Wipe off/restore map icons when switches are toggled\r\n  function buildSwitchChangeListener (data, dataType, storageKey) {\r\n    return function () {\r\n      Store.set(storageKey, this.checked)\r\n      if (this.checked) {\r\n        updateMap()\r\n      } else {\r\n        $.each(dataType, function (d, dType) {\r\n          $.each(data[dType], function (key, value) {\r\n            // for any marker you're turning off, you'll want to wipe off the range\r\n            if (data[dType][key].marker.rangeCircle) {\r\n              data[dType][key].marker.rangeCircle.setMap(null)\r\n              delete data[dType][key].marker.rangeCircle\r\n            }\r\n            if (storageKey !== 'showRanges') data[dType][key].marker.setMap(null)\r\n          })\r\n          if (storageKey !== 'showRanges') data[dType] = {}\r\n        })\r\n        if (storageKey === 'showRanges') {\r\n          updateMap()\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // Setup UI element interactions\r\n  $('#gyms-switch').change(buildSwitchChangeListener(mapData, ['gyms'], 'showGyms'))\r\n  $('#pokemon-switch').change(buildSwitchChangeListener(mapData, ['pokemons'], 'showPokemon'))\r\n  $('#scanned-switch').change(buildSwitchChangeListener(mapData, ['scanned'], 'showScanned'))\r\n  $('#spawnpoints-switch').change(buildSwitchChangeListener(mapData, ['spawnpoints'], 'showSpawnpoints'))\r\n  $('#ranges-switch').change(buildSwitchChangeListener(mapData, ['gyms', 'pokemons', 'pokestops'], 'showRanges'))\r\n\r\n  $('#pokestops-switch').change(function () {\r\n    var options = {\r\n      'duration': 500\r\n    }\r\n    var wrapper = $('#lured-pokestops-only-wrapper')\r\n    if (this.checked) {\r\n      wrapper.show(options)\r\n    } else {\r\n      wrapper.hide(options)\r\n    }\r\n    return buildSwitchChangeListener(mapData, ['pokestops'], 'showPokestops').bind(this)()\r\n  })\r\n\r\n  $('#sound-switch').change(function () {\r\n    Store.set('playSound', this.checked)\r\n  })\r\n\r\n  $('#geoloc-switch').change(function () {\r\n    $('#next-location').prop('disabled', this.checked)\r\n    $('#next-location').css('background-color', this.checked ? '#e0e0e0' : '#ffffff')\r\n    if (!navigator.geolocation) {\r\n      this.checked = false\r\n    } else {\r\n      Store.set('geoLocate', this.checked)\r\n    }\r\n  })\r\n\r\n  $('#lock-marker-switch').change(function () {\r\n    Store.set('lockMarker', this.checked)\r\n    searchMarker.setDraggable(!this.checked)\r\n  })\r\n\r\n  $('#search-switch').change(function () {\r\n    searchControl(this.checked ? 'on' : 'off')\r\n  })\r\n\r\n  $('#start-at-user-location-switch').change(function () {\r\n    Store.set('startAtUserLocation', this.checked)\r\n  })\r\n\r\n  $('#follow-my-location-switch').change(function () {\r\n    if (!navigator.geolocation) {\r\n      this.checked = false\r\n    } else {\r\n      Store.set('followMyLocation', this.checked)\r\n    }\r\n    locationMarker.setDraggable(!this.checked)\r\n  })\r\n\r\n  if ($('#nav-accordion').length) {\r\n    $('#nav-accordion').accordion({\r\n      active: 0,\r\n      collapsible: true,\r\n      heightStyle: 'content'\r\n    })\r\n  }\r\n})\r\n"]}